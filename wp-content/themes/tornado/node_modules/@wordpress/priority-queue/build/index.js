"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createQueue = void 0;
var requestIdleCallback = window.requestIdleCallback ? window.requestIdleCallback : window.requestAnimationFrame;

var createQueue = function createQueue() {
  var waitingList = [];
  var elementsMap = new WeakMap();
  var isRunning = false;

  var runWaitingList = function runWaitingList(deadline) {
    do {
      if (waitingList.length === 0) {
        isRunning = false;
        return;
      }

      var nextElement = waitingList.shift();
      elementsMap.get(nextElement)();
      elementsMap.delete(nextElement);
    } while (deadline && deadline.timeRemaining && deadline.timeRemaining() > 0);

    requestIdleCallback(runWaitingList);
  };

  var add = function add(element, item) {
    if (!elementsMap.has(element)) {
      waitingList.push(element);
    }

    elementsMap.set(element, item);

    if (!isRunning) {
      isRunning = true;
      requestIdleCallback(runWaitingList);
    }
  };

  var flush = function flush(element) {
    if (!elementsMap.has(element)) {
      return false;
    }

    elementsMap.delete(element);
    var index = waitingList.indexOf(element);
    waitingList.splice(index, 1);
    return true;
  };

  return {
    add: add,
    flush: flush
  };
};

exports.createQueue = createQueue;
//# sourceMappingURL=index.js.map