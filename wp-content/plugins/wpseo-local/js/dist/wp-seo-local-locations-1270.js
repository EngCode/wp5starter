(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
/**
 * wpseoLocalGeocodingRepository class for geocoding addresses.
 */
class GeocodingRepository {
	/**
  * Geocode the address based using the Google maps JavaScript geocoding API
  *
  * @var object An object containing either { "address": <address as a string> } or { "location": <the LatLng coordinates>}
  */
	static async geoCodeAddress(location) {
		const geocoder = new google.maps.Geocoder();

		if (typeof location === "object") {
			return new Promise((resolve, reject) => {
				geocoder.geocode(location, (results, status) => {
					if (status === "OK") {
						return resolve(results);
					}

					return reject(status);
				});
			});
		}

		throw new Error("Location should be an object");
	}
}
exports.default = GeocodingRepository;

},{}],2:[function(require,module,exports){
"use strict";

var _wpSeoLocalGeocodingRepository = require("./wp-seo-local-geocoding-repository.js");

var _wpSeoLocalGeocodingRepository2 = _interopRequireDefault(_wpSeoLocalGeocodingRepository);

var _wpSeoLocalTimezoneRepository = require("./wp-seo-local-timezone-repository.js");

var _wpSeoLocalTimezoneRepository2 = _interopRequireDefault(_wpSeoLocalTimezoneRepository);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * A class to handle all address changes and maybe calculate new lat/long and timezone.
 */
class Locations {
	/**
  * Constructor for the wpseoLocalGeocodingRepository.
  * Here we assign fields to class constants and bind methods.
  */
	constructor() {
		this.addressFields = [document.querySelector(".wpseo_local_address_input"), document.querySelector(".wpseo_local_zipcode_input"), document.querySelector(".wpseo_local_city_input"), document.querySelector(".wpseo_local_state_input"), document.querySelector(".select[id*=\"_country\"]")];

		this.latLngSettingsContainer = document.getElementById("location-coordinates-settings");
		this.latLngSettingsFieldWrapper = document.getElementById("location-coordinates-settings-lat-lng-wrapper");
		this.calculateLatLngButton = document.getElementById("calculate_lat_lng_button");

		this.latField = document.querySelector(".wpseo_local_lat_input");
		this.lngField = document.querySelector(".wpseo_local_lng_input");

		this.timezoneField = document.querySelector("select[id*=\"_timezone\"]");

		this.apiKey = wpseoLocalLocations.apiKey;

		this.maybeGeoCodeAddress = this.maybeGeoCodeAddress.bind(this);
		this.maybeShowAddressChangesNotification = this.maybeShowAddressChangesNotification.bind(this);
		this.setTimezone = this.setTimezone.bind(this);
		this.formatAddress = this.formatAddress.bind(this);
	}

	/**
  * Add event listeners to fire a function upon specified events.
  */
	addEventListeners() {
		document.addEventListener("click", this.maybeGeoCodeAddress);
		document.addEventListener("change", this.maybeShowAddressChangesNotification);
	}

	/**
  * Check wheter a address should be geocoded.
  *
  * @param e The event passed by the event listener.
  */
	async maybeGeoCodeAddress(e) {
		/**
   * If either the lat or lng field does not exist bail to avoid (console)errors.
   */
		if (this.latField === null || this.lngField === null) {
			return;
		}

		this.calculateLatLngNotification = document.querySelector(".yoast-seo-local__alert");

		if (this.calculateLatLngButton === e.target) {
			e.preventDefault();
			this.errorField = document.querySelector(".wpseo_local_geocoding_error");
			const latOldValue = this.latField.value;
			const lngOldValue = this.lngField.value;

			const formattedAddress = this.formatAddress();

			if (this.errorField !== null) {
				this.errorField.parentNode.removeChild(this.errorField);
			}

			/**
    * Empty the lat/lng fields. They will be recalculated and result in empty fields if geocoding failed.
    *
    * @type {string}
    */
			this.latField.value = "";
			this.lngField.value = "";

			const wrapper = document.createElement("div");

			/**
    * Try Geocoding of the given address. If it fails generate an error message based on the returned error.
    */
			try {
				const results = await _wpSeoLocalGeocodingRepository2.default.geoCodeAddress({ address: formattedAddress });

				this.latField.value = results[0].geometry.location.lat();
				this.lngField.value = results[0].geometry.location.lng();

				if (this.calculateLatLngNotification !== null) {
					this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification);
				}
				wrapper.innerHTML = wpseoLocalLocations.calculateLatLngSuccessMessage;

				this.latLngSettingsContainer.insertBefore(wrapper, this.latLngSettingsFieldWrapper);

				if (this.latField.value !== "" && this.lngField.value !== "" && this.latField.value !== latOldValue || this.lngField.value !== lngOldValue) {
					this.setTimezone();
				}
			} catch (error) {
				const errorFieldElement = document.createElement("p");
				errorFieldElement.classList.add("wpseo_local_geocoding_error");

				if (this.calculateLatLngNotification !== null) {
					this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification);
				}
				wrapper.innerHTML = wpseoLocalLocations.calculateLatLngErrorMessage;
				this.latLngSettingsContainer.insertBefore(wrapper, this.latLngSettingsFieldWrapper);

				switch (error) {
					case "ZERO_RESULTS":
						errorFieldElement.appendChild(document.createTextNode("We could not retrieve coordinates for this address."));
						break;
					case "OVER_QUERY_LIMIT":
						errorFieldElement.appendChild(document.createTextNode("You are over your query limit."));
						break;
					case "REQUEST_DENIED":
						errorFieldElement.appendChild(document.createTextNode("Your API key is not entered or not valid."));
				}

				// Display the error after the longitude field.
				// @note: Temporarily removed. Will add this back later.
				// this.lngField.parentNode.after( errorFieldElement );
			}
		}
	}

	async maybeShowAddressChangesNotification(e) {
		if (this.addressFields.indexOf(e.target) !== -1) {
			this.calculateLatLngNotification = document.querySelector(".yoast-seo-local__alert");

			if (this.calculateLatLngNotification !== null) {
				this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification);
			}

			const wrapper = document.createElement("div");
			wrapper.innerHTML = wpseoLocalLocations.addressChangedMessage;

			this.latLngSettingsContainer.insertBefore(wrapper, this.latLngSettingsFieldWrapper);
		}
	}

	/**
  * Format an address the Google Geocoder can use based on the filled in address fields.
  *
  * @returns {string}
  */
	formatAddress() {
		let address = [];

		this.addressFields.forEach(function (addressField) {
			if (addressField.value !== "") {
				address.push(addressField.value);
			}
		});

		return address.join(", ");
	}

	async setTimezone() {
		/**
   * Check if either the lat or lng field has changed and if they are not empty
   */
		const latLng = this.latField.value + ", " + this.lngField.value;

		try {
			const result = await _wpSeoLocalTimezoneRepository2.default.getTimezone(latLng, this.apiKey);

			if (result !== "") {
				jQuery(this.timezoneField).val(result).trigger("change");
			}
		} catch (error) {
			console.log(error);
		}
	}
}

const locationsInstance = new Locations();

locationsInstance.addEventListeners();

},{"./wp-seo-local-geocoding-repository.js":1,"./wp-seo-local-timezone-repository.js":3}],3:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
/**
 * TimezoneRepository class for retrieving the timezone based based on lat/lng coordinates.
 */
class TimezoneRepository {
	/**
  * Get the timezone from Google's Timezone API
  *
  * @var object An object containing either { "address": <address as a string> } or { "location": <the LatLng coordinates>}
  */
	static async getTimezone(latLng, apiKey) {
		const timestamp = Math.floor(Date.now() / 1000);

		const searchParams = new URLSearchParams();

		searchParams.append("location", latLng);
		searchParams.append("timestamp", timestamp);
		searchParams.append("key", apiKey);

		const request = "https://maps.googleapis.com/maps/api/timezone/json?" + searchParams;

		return new Promise((resolve, reject) => {
			const xhr = new XMLHttpRequest();

			xhr.open("GET", request);
			xhr.onload = () => {
				if (xhr.status === 200) {
					const output = JSON.parse(xhr.responseText);

					if (output.status === 'OK') {
						return resolve(output.timeZoneId);
					}

					return reject(output);
				}

				return reject(xhr.status);
			};
			xhr.send();
		});
	}
}
exports.default = TimezoneRepository;

},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9zcmMvd3Atc2VvLWxvY2FsLWdlb2NvZGluZy1yZXBvc2l0b3J5LmpzIiwianMvc3JjL3dwLXNlby1sb2NhbC1sb2NhdGlvbnMuanMiLCJqcy9zcmMvd3Atc2VvLWxvY2FsLXRpbWV6b25lLXJlcG9zaXRvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQ0FBOzs7QUFHZSxNQUFNLG1CQUFOLENBQTBCO0FBQ3hDOzs7OztBQUtBLGNBQWEsY0FBYixDQUE2QixRQUE3QixFQUF3QztBQUN2QyxRQUFNLFdBQVcsSUFBSSxPQUFPLElBQVAsQ0FBWSxRQUFoQixFQUFqQjs7QUFFQSxNQUFLLE9BQU8sUUFBUCxLQUFvQixRQUF6QixFQUFvQztBQUNuQyxVQUFPLElBQUksT0FBSixDQUFhLENBQUUsT0FBRixFQUFXLE1BQVgsS0FBdUI7QUFDMUMsYUFBUyxPQUFULENBQWtCLFFBQWxCLEVBQTRCLENBQUUsT0FBRixFQUFXLE1BQVgsS0FBdUI7QUFDbEQsU0FBSyxXQUFXLElBQWhCLEVBQXVCO0FBQ3RCLGFBQU8sUUFBUyxPQUFULENBQVA7QUFDQTs7QUFFRCxZQUFPLE9BQVEsTUFBUixDQUFQO0FBQ0EsS0FORDtBQU9BLElBUk0sQ0FBUDtBQVNBOztBQUVELFFBQU0sSUFBSSxLQUFKLENBQVcsOEJBQVgsQ0FBTjtBQUNBO0FBdEJ1QztrQkFBcEIsbUI7Ozs7O0FDSHJCOzs7O0FBQ0E7Ozs7OztBQUVBOzs7QUFHQSxNQUFNLFNBQU4sQ0FBZ0I7QUFDZjs7OztBQUlBLGVBQWM7QUFDYixPQUFLLGFBQUwsR0FBcUIsQ0FDcEIsU0FBUyxhQUFULENBQXdCLDRCQUF4QixDQURvQixFQUVwQixTQUFTLGFBQVQsQ0FBd0IsNEJBQXhCLENBRm9CLEVBR3BCLFNBQVMsYUFBVCxDQUF3Qix5QkFBeEIsQ0FIb0IsRUFJcEIsU0FBUyxhQUFULENBQXdCLDBCQUF4QixDQUpvQixF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QUFvQixJQUFJLFNBQUosRUFBMUI7O0FBRUEsa0JBQWtCLGlCQUFsQjs7Ozs7Ozs7QUN0TEE7OztBQUdlLE1BQU0sa0JBQU4sQ0FBeUI7QUFDdkM7Ozs7O0FBS0EsY0FBYSxXQUFiLENBQTBCLE1BQTFCLEVBQWtDLE1BQWxDLEVBQTJDO0FBQzFDLFFBQU0sWUFBWSxLQUFLLEtBQUwsQ0FBVyxLQUFLLEdBQUwsS0FBYSxJQUF4QixDQUFsQjs7QUFFQSxRQUFNLGVBQWUsSUFBSSxlQUFKLEVBQXJCOztBQUVBLGVBQWEsTUFBYixDQUFxQixVQUFyQixFQUFpQyxNQUFqQztBQUNBLGVBQWEsTUFBYixDQUFxQixXQUFyQixFQUFrQyxTQUFsQztBQUNBLGVBQWEsTUFBYixDQUFxQixLQUFyQixFQUE0QixNQUE1Qjs7QUFFQSxRQUFNLFVBQVUsd0RBQXdELFlBQXhFOztBQUVBLFNBQU8sSUFBSSxPQUFKLENBQWEsQ0FBRSxPQUFGLEVBQVcsTUFBWCxLQUF1QjtBQUMxQyxTQUFNLE1BQU0sSUFBSSxjQUFKLEVBQVo7O0FBRUEsT0FBSSxJQUFKLENBQVUsS0FBVixFQUFpQixPQUFqQjtBQUNBLE9BQUksTUFBSixHQUFhLE1BQU07QUFDbEIsUUFBSSxJQUFJLE1BQUosS0FBZSxHQUFuQixFQUF5QjtBQUN4QixXQUFNLFNBQVMsS0FBSyxLQUFMLENBQVcsSUFBSSxZQUFmLENBQWY7O0FBRUEsU0FBSSxPQUFPLE1BQVAsS0FBa0IsSUFBdEIsRUFBNkI7QUFDNUIsYUFBTyxRQUFTLE9BQU8sVUFBaEIsQ0FBUDtBQUNBOztBQUVELFlBQU8sT0FBUSxNQUFSLENBQVA7QUFDQTs7QUFFRCxXQUFPLE9BQVEsSUFBSSxNQUFaLENBQVA7QUFDQSxJQVpEO0FBYUEsT0FBSSxJQUFKO0FBQ0EsR0FsQk0sQ0FBUDtBQW1CQTtBQXBDc0M7a0JBQW5CLGtCIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiLyoqXG4gKiB3cHNlb0xvY2FsR2VvY29kaW5nUmVwb3NpdG9yeSBjbGFzcyBmb3IgZ2VvY29kaW5nIGFkZHJlc3Nlcy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2VvY29kaW5nUmVwb3NpdG9yeSB7XG5cdC8qKlxuXHQgKiBHZW9jb2RlIHRoZSBhZGRyZXNzIGJhc2VkIHVzaW5nIHRoZSBHb29nbGUgbWFwcyBKYXZhU2NyaXB0IGdlb2NvZGluZyBBUElcblx0ICpcblx0ICogQHZhciBvYmplY3QgQW4gb2JqZWN0IGNvbnRhaW5pbmcgZWl0aGVyIHsgXCJhZGRyZXNzXCI6IDxhZGRyZXNzIGFzIGEgc3RyaW5nPiB9IG9yIHsgXCJsb2NhdGlvblwiOiA8dGhlIExhdExuZyBjb29yZGluYXRlcz59XG5cdCAqL1xuXHRzdGF0aWMgYXN5bmMgZ2VvQ29kZUFkZHJlc3MoIGxvY2F0aW9uICkge1xuXHRcdGNvbnN0IGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyKCk7XG5cblx0XHRpZiAoIHR5cGVvZiBsb2NhdGlvbiA9PT0gXCJvYmplY3RcIiApIHtcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSggKCByZXNvbHZlLCByZWplY3QgKSA9PiB7XG5cdFx0XHRcdGdlb2NvZGVyLmdlb2NvZGUoIGxvY2F0aW9uLCAoIHJlc3VsdHMsIHN0YXR1cyApID0+IHtcblx0XHRcdFx0XHRpZiAoIHN0YXR1cyA9PT0gXCJPS1wiICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc29sdmUoIHJlc3VsdHMgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcmVqZWN0KCBzdGF0dXMgKTtcblx0XHRcdFx0fSApO1xuXHRcdFx0fSApO1xuXHRcdH1cblxuXHRcdHRocm93IG5ldyBFcnJvciggXCJMb2NhdGlvbiBzaG91bGQgYmUgYW4gb2JqZWN0XCIgKTtcblx0fVxufSIsImltcG9ydCBHZW9Db2RpbmdSZXBvc2l0b3J5IGZyb20gXCIuL3dwLXNlby1sb2NhbC1nZW9jb2RpbmctcmVwb3NpdG9yeS5qc1wiO1xuaW1wb3J0IFRpbWV6b25lUmVwb3NpdG9yeSBmcm9tIFwiLi93cC1zZW8tbG9jYWwtdGltZXpvbmUtcmVwb3NpdG9yeS5qc1wiO1xuXG4vKipcbiAqIEEgY2xhc3MgdG8gaGFuZGxlIGFsbCBhZGRyZXNzIGNoYW5nZXMgYW5kIG1heWJlIGNhbGN1bGF0ZSBuZXcgbGF0L2xvbmcgYW5kIHRpbWV6b25lLlxuICovXG5jbGFzcyBMb2NhdGlvbnMge1xuXHQvKipcblx0ICogQ29uc3RydWN0b3IgZm9yIHRoZSB3cHNlb0xvY2FsR2VvY29kaW5nUmVwb3NpdG9yeS5cblx0ICogSGVyZSB3ZSBhc3NpZ24gZmllbGRzIHRvIGNsYXNzIGNvbnN0YW50cyBhbmQgYmluZCBtZXRob2RzLlxuXHQgKi9cblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0dGhpcy5hZGRyZXNzRmllbGRzID0gW1xuXHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIud3BzZW9fbG9jYWxfYWRkcmVzc19pbnB1dFwiICksXG5cdFx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBcIi53cHNlb19sb2NhbF96aXBjb2RlX2lucHV0XCIgKSxcblx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwiLndwc2VvX2xvY2FsX2NpdHlfaW5wdXRcIiApLFxuXHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIud3BzZW9fbG9jYWxfc3RhdGVfaW5wdXRcIiApLFxuXHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIuc2VsZWN0W2lkKj1cXFwiX2NvdW50cnlcXFwiXVwiICksXG5cdFx0XTtcblxuXHRcdHRoaXMubGF0TG5nU2V0dGluZ3NDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggXCJsb2NhdGlvbi1jb29yZGluYXRlcy1zZXR0aW5nc1wiICk7XG5cdFx0dGhpcy5sYXRMbmdTZXR0aW5nc0ZpZWxkV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBcImxvY2F0aW9uLWNvb3JkaW5hdGVzLXNldHRpbmdzLWxhdC1sbmctd3JhcHBlclwiICk7XG5cdFx0dGhpcy5jYWxjdWxhdGVMYXRMbmdCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggXCJjYWxjdWxhdGVfbGF0X2xuZ19idXR0b25cIiApO1xuXG5cdFx0dGhpcy5sYXRGaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwiLndwc2VvX2xvY2FsX2xhdF9pbnB1dFwiICk7XG5cdFx0dGhpcy5sbmdGaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwiLndwc2VvX2xvY2FsX2xuZ19pbnB1dFwiICk7XG5cblx0XHR0aGlzLnRpbWV6b25lRmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBcInNlbGVjdFtpZCo9XFxcIl90aW1lem9uZVxcXCJdXCIgKTtcblxuXHRcdHRoaXMuYXBpS2V5ID0gd3BzZW9Mb2NhbExvY2F0aW9ucy5hcGlLZXk7XG5cblx0XHR0aGlzLm1heWJlR2VvQ29kZUFkZHJlc3MgPSB0aGlzLm1heWJlR2VvQ29kZUFkZHJlc3MuYmluZCggdGhpcyApO1xuXHRcdHRoaXMubWF5YmVTaG93QWRkcmVzc0NoYW5nZXNOb3RpZmljYXRpb24gPSB0aGlzLm1heWJlU2hvd0FkZHJlc3NDaGFuZ2VzTm90aWZpY2F0aW9uLmJpbmQoIHRoaXMgKTtcblx0XHR0aGlzLnNldFRpbWV6b25lID0gdGhpcy5zZXRUaW1lem9uZS5iaW5kKCB0aGlzICk7XG5cdFx0dGhpcy5mb3JtYXRBZGRyZXNzID0gdGhpcy5mb3JtYXRBZGRyZXNzLmJpbmQoIHRoaXMgKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBBZGQgZXZlbnQgbGlzdGVuZXJzIHRvIGZpcmUgYSBmdW5jdGlvbiB1cG9uIHNwZWNpZmllZCBldmVudHMuXG5cdCAqL1xuXHRhZGRFdmVudExpc3RlbmVycygpIHtcblx0XHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCBcImNsaWNrXCIsIHRoaXMubWF5YmVHZW9Db2RlQWRkcmVzcyApO1xuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIFwiY2hhbmdlXCIsIHRoaXMubWF5YmVTaG93QWRkcmVzc0NoYW5nZXNOb3RpZmljYXRpb24gKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVjayB3aGV0ZXIgYSBhZGRyZXNzIHNob3VsZCBiZSBnZW9jb2RlZC5cblx0ICpcblx0ICogQHBhcmFtIGUgVGhlIGV2ZW50IHBhc3NlZCBieSB0aGUgZXZlbnQgbGlzdGVuZXIuXG5cdCAqL1xuXHRhc3luYyBtYXliZUdlb0NvZGVBZGRyZXNzKCBlICkge1xuXHRcdC8qKlxuXHRcdCAqIElmIGVpdGhlciB0aGUgbGF0IG9yIGxuZyBmaWVsZCBkb2VzIG5vdCBleGlzdCBiYWlsIHRvIGF2b2lkIChjb25zb2xlKWVycm9ycy5cblx0XHQgKi9cblx0XHRpZiAoIHRoaXMubGF0RmllbGQgPT09IG51bGwgfHwgdGhpcy5sbmdGaWVsZCA9PT0gbnVsbCApIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLmNhbGN1bGF0ZUxhdExuZ05vdGlmaWNhdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwiLnlvYXN0LXNlby1sb2NhbF9fYWxlcnRcIiApO1xuXG5cdFx0aWYgKCB0aGlzLmNhbGN1bGF0ZUxhdExuZ0J1dHRvbiA9PT0gZS50YXJnZXQgKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR0aGlzLmVycm9yRmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBcIi53cHNlb19sb2NhbF9nZW9jb2RpbmdfZXJyb3JcIiApO1xuXHRcdFx0Y29uc3QgbGF0T2xkVmFsdWUgPSB0aGlzLmxhdEZpZWxkLnZhbHVlO1xuXHRcdFx0Y29uc3QgbG5nT2xkVmFsdWUgPSB0aGlzLmxuZ0ZpZWxkLnZhbHVlO1xuXG5cdFx0XHRjb25zdCBmb3JtYXR0ZWRBZGRyZXNzID0gdGhpcy5mb3JtYXRBZGRyZXNzKCk7XG5cblx0XHRcdGlmICggdGhpcy5lcnJvckZpZWxkICE9PSBudWxsICkge1xuXHRcdFx0XHR0aGlzLmVycm9yRmllbGQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggdGhpcy5lcnJvckZpZWxkICk7XG5cdFx0XHR9XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogRW1wdHkgdGhlIGxhdC9sbmcgZmllbGRzLiBUaGV5IHdpbGwgYmUgcmVjYWxjdWxhdGVkIGFuZCByZXN1bHQgaW4gZW1wdHkgZmllbGRzIGlmIGdlb2NvZGluZyBmYWlsZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHR5cGUge3N0cmluZ31cblx0XHRcdCAqL1xuXHRcdFx0dGhpcy5sYXRGaWVsZC52YWx1ZSA9IFwiXCI7XG5cdFx0XHR0aGlzLmxuZ0ZpZWxkLnZhbHVlID0gXCJcIjtcblxuXHRcdFx0Y29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIFwiZGl2XCIgKTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBUcnkgR2VvY29kaW5nIG9mIHRoZSBnaXZlbiBhZGRyZXNzLiBJZiBpdCBmYWlscyBnZW5lcmF0ZSBhbiBlcnJvciBtZXNzYWdlIGJhc2VkIG9uIHRoZSByZXR1cm5lZCBlcnJvci5cblx0XHRcdCAqL1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IGF3YWl0IEdlb0NvZGluZ1JlcG9zaXRvcnkuZ2VvQ29kZUFkZHJlc3MoIHsgYWRkcmVzczogZm9ybWF0dGVkQWRkcmVzcyB9ICk7XG5cblx0XHRcdFx0dGhpcy5sYXRGaWVsZC52YWx1ZSA9IHJlc3VsdHNbIDAgXS5nZW9tZXRyeS5sb2NhdGlvbi5sYXQoKTtcblx0XHRcdFx0dGhpcy5sbmdGaWVsZC52YWx1ZSA9IHJlc3VsdHNbIDAgXS5nZW9tZXRyeS5sb2NhdGlvbi5sbmcoKTtcblxuXHRcdFx0XHRpZiAoIHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uICE9PSBudWxsICkge1xuXHRcdFx0XHRcdHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0d3JhcHBlci5pbm5lckhUTUwgPSB3cHNlb0xvY2FsTG9jYXRpb25zLmNhbGN1bGF0ZUxhdExuZ1N1Y2Nlc3NNZXNzYWdlO1xuXG5cdFx0XHRcdHRoaXMubGF0TG5nU2V0dGluZ3NDb250YWluZXIuaW5zZXJ0QmVmb3JlKCB3cmFwcGVyLCB0aGlzLmxhdExuZ1NldHRpbmdzRmllbGRXcmFwcGVyICk7XG5cblx0XHRcdFx0aWYgKCB0aGlzLmxhdEZpZWxkLnZhbHVlICE9PSBcIlwiICYmIHRoaXMubG5nRmllbGQudmFsdWUgIT09IFwiXCIgJiYgdGhpcy5sYXRGaWVsZC52YWx1ZSAhPT0gbGF0T2xkVmFsdWUgfHwgdGhpcy5sbmdGaWVsZC52YWx1ZSAhPT0gbG5nT2xkVmFsdWUgKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXRUaW1lem9uZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gY2F0Y2ggKCBlcnJvciApIHtcblx0XHRcdFx0Y29uc3QgZXJyb3JGaWVsZEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBcInBcIiApO1xuXHRcdFx0XHRlcnJvckZpZWxkRWxlbWVudC5jbGFzc0xpc3QuYWRkKCBcIndwc2VvX2xvY2FsX2dlb2NvZGluZ19lcnJvclwiICk7XG5cblx0XHRcdFx0aWYgKCB0aGlzLmNhbGN1bGF0ZUxhdExuZ05vdGlmaWNhdGlvbiAhPT0gbnVsbCApIHtcblx0XHRcdFx0XHR0aGlzLmNhbGN1bGF0ZUxhdExuZ05vdGlmaWNhdGlvbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCB0aGlzLmNhbGN1bGF0ZUxhdExuZ05vdGlmaWNhdGlvbiApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHdyYXBwZXIuaW5uZXJIVE1MID0gd3BzZW9Mb2NhbExvY2F0aW9ucy5jYWxjdWxhdGVMYXRMbmdFcnJvck1lc3NhZ2U7XG5cdFx0XHRcdHRoaXMubGF0TG5nU2V0dGluZ3NDb250YWluZXIuaW5zZXJ0QmVmb3JlKCB3cmFwcGVyLCB0aGlzLmxhdExuZ1NldHRpbmdzRmllbGRXcmFwcGVyICk7XG5cblx0XHRcdFx0c3dpdGNoICggZXJyb3IgKSB7XG5cdFx0XHRcdFx0Y2FzZSBcIlpFUk9fUkVTVUxUU1wiOlxuXHRcdFx0XHRcdFx0ZXJyb3JGaWVsZEVsZW1lbnQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBcIldlIGNvdWxkIG5vdCByZXRyaWV2ZSBjb29yZGluYXRlcyBmb3IgdGhpcyBhZGRyZXNzLlwiICkgKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgXCJPVkVSX1FVRVJZX0xJTUlUXCI6XG5cdFx0XHRcdFx0XHRlcnJvckZpZWxkRWxlbWVudC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIFwiWW91IGFyZSBvdmVyIHlvdXIgcXVlcnkgbGltaXQuXCIgKSApO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSBcIlJFUVVFU1RfREVOSUVEXCI6XG5cdFx0XHRcdFx0XHRlcnJvckZpZWxkRWxlbWVudC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIFwiWW91ciBBUEkga2V5IGlzIG5vdCBlbnRlcmVkIG9yIG5vdCB2YWxpZC5cIiApICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBEaXNwbGF5IHRoZSBlcnJvciBhZnRlciB0aGUgbG9uZ2l0dWRlIGZpZWxkLlxuXHRcdFx0XHQvLyBAbm90ZTogVGVtcG9yYXJpbHkgcmVtb3ZlZC4gV2lsbCBhZGQgdGhpcyBiYWNrIGxhdGVyLlxuXHRcdFx0XHQvLyB0aGlzLmxuZ0ZpZWxkLnBhcmVudE5vZGUuYWZ0ZXIoIGVycm9yRmllbGRFbGVtZW50ICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0YXN5bmMgbWF5YmVTaG93QWRkcmVzc0NoYW5nZXNOb3RpZmljYXRpb24oIGUgKSB7XG5cdFx0aWYgKCB0aGlzLmFkZHJlc3NGaWVsZHMuaW5kZXhPZiggZS50YXJnZXQgKSAhPT0gLTEgKSB7XG5cdFx0XHR0aGlzLmNhbGN1bGF0ZUxhdExuZ05vdGlmaWNhdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwiLnlvYXN0LXNlby1sb2NhbF9fYWxlcnRcIiApO1xuXG5cdFx0XHRpZiAoIHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uICE9PSBudWxsICkge1xuXHRcdFx0XHR0aGlzLmNhbGN1bGF0ZUxhdExuZ05vdGlmaWNhdGlvbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCB0aGlzLmNhbGN1bGF0ZUxhdExuZ05vdGlmaWNhdGlvbiApO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggXCJkaXZcIiApO1xuXHRcdFx0d3JhcHBlci5pbm5lckhUTUwgPSB3cHNlb0xvY2FsTG9jYXRpb25zLmFkZHJlc3NDaGFuZ2VkTWVzc2FnZTtcblxuXHRcdFx0dGhpcy5sYXRMbmdTZXR0aW5nc0NvbnRhaW5lci5pbnNlcnRCZWZvcmUoIHdyYXBwZXIsIHRoaXMubGF0TG5nU2V0dGluZ3NGaWVsZFdyYXBwZXIgKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogRm9ybWF0IGFuIGFkZHJlc3MgdGhlIEdvb2dsZSBHZW9jb2RlciBjYW4gdXNlIGJhc2VkIG9uIHRoZSBmaWxsZWQgaW4gYWRkcmVzcyBmaWVsZHMuXG5cdCAqXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd9XG5cdCAqL1xuXHRmb3JtYXRBZGRyZXNzKCkge1xuXHRcdGxldCBhZGRyZXNzID0gW107XG5cblx0XHR0aGlzLmFkZHJlc3NGaWVsZHMuZm9yRWFjaCggZnVuY3Rpb24oIGFkZHJlc3NGaWVsZCApIHtcblx0XHRcdGlmICggYWRkcmVzc0ZpZWxkLnZhbHVlICE9PSBcIlwiICkge1xuXHRcdFx0XHRhZGRyZXNzLnB1c2goIGFkZHJlc3NGaWVsZC52YWx1ZSApO1xuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdHJldHVybiBhZGRyZXNzLmpvaW4oIFwiLCBcIiApO1xuXHR9XG5cblx0YXN5bmMgc2V0VGltZXpvbmUoKSB7XG5cdFx0LyoqXG5cdFx0ICogQ2hlY2sgaWYgZWl0aGVyIHRoZSBsYXQgb3IgbG5nIGZpZWxkIGhhcyBjaGFuZ2VkIGFuZCBpZiB0aGV5IGFyZSBub3QgZW1wdHlcblx0XHQgKi9cblx0XHRjb25zdCBsYXRMbmcgPSB0aGlzLmxhdEZpZWxkLnZhbHVlICsgXCIsIFwiICsgdGhpcy5sbmdGaWVsZC52YWx1ZTtcblxuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCByZXN1bHQgPSBhd2FpdCBUaW1lem9uZVJlcG9zaXRvcnkuZ2V0VGltZXpvbmUoIGxhdExuZywgdGhpcy5hcGlLZXkgKTtcblxuXHRcdFx0aWYgKCByZXN1bHQgIT09IFwiXCIgKSB7XG5cdFx0XHRcdGpRdWVyeSggdGhpcy50aW1lem9uZUZpZWxkICkudmFsKCByZXN1bHQgKS50cmlnZ2VyKCBcImNoYW5nZVwiICk7XG5cdFx0XHR9XG5cdFx0fSBjYXRjaCAoIGVycm9yICkge1xuXHRcdFx0Y29uc29sZS5sb2coIGVycm9yICk7XG5cdFx0fVxuXHR9XG59XG5cbmNvbnN0IGxvY2F0aW9uc0luc3RhbmNlID0gbmV3IExvY2F0aW9ucygpO1xuXG5sb2NhdGlvbnNJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVycygpO1xuIiwiLyoqXG4gKiBUaW1lem9uZVJlcG9zaXRvcnkgY2xhc3MgZm9yIHJldHJpZXZpbmcgdGhlIHRpbWV6b25lIGJhc2VkIGJhc2VkIG9uIGxhdC9sbmcgY29vcmRpbmF0ZXMuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRpbWV6b25lUmVwb3NpdG9yeSB7XG5cdC8qKlxuXHQgKiBHZXQgdGhlIHRpbWV6b25lIGZyb20gR29vZ2xlJ3MgVGltZXpvbmUgQVBJXG5cdCAqXG5cdCAqIEB2YXIgb2JqZWN0IEFuIG9iamVjdCBjb250YWluaW5nIGVpdGhlciB7IFwiYWRkcmVzc1wiOiA8YWRkcmVzcyBhcyBhIHN0cmluZz4gfSBvciB7IFwibG9jYXRpb25cIjogPHRoZSBMYXRMbmcgY29vcmRpbmF0ZXM+fVxuXHQgKi9cblx0c3RhdGljIGFzeW5jIGdldFRpbWV6b25lKCBsYXRMbmcsIGFwaUtleSApIHtcblx0XHRjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcblxuXHRcdGNvbnN0IHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcblxuXHRcdHNlYXJjaFBhcmFtcy5hcHBlbmQoIFwibG9jYXRpb25cIiwgbGF0TG5nICk7XG5cdFx0c2VhcmNoUGFyYW1zLmFwcGVuZCggXCJ0aW1lc3RhbXBcIiwgdGltZXN0YW1wICk7XG5cdFx0c2VhcmNoUGFyYW1zLmFwcGVuZCggXCJrZXlcIiwgYXBpS2V5ICk7XG5cblx0XHRjb25zdCByZXF1ZXN0ID0gXCJodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvdGltZXpvbmUvanNvbj9cIiArIHNlYXJjaFBhcmFtcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSggKCByZXNvbHZlLCByZWplY3QgKSA9PiB7XG5cdFx0XHRjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuXHRcdFx0eGhyLm9wZW4oIFwiR0VUXCIsIHJlcXVlc3QgKTtcblx0XHRcdHhoci5vbmxvYWQgPSAoKSA9PiB7XG5cdFx0XHRcdGlmKCB4aHIuc3RhdHVzID09PSAyMDAgKSB7XG5cdFx0XHRcdFx0Y29uc3Qgb3V0cHV0ID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcblxuXHRcdFx0XHRcdGlmKCBvdXRwdXQuc3RhdHVzID09PSAnT0snICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc29sdmUoIG91dHB1dC50aW1lWm9uZUlkICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJlamVjdCggb3V0cHV0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByZWplY3QoIHhoci5zdGF0dXMgKTtcblx0XHRcdH1cblx0XHRcdHhoci5zZW5kKCk7XG5cdFx0fSApO1xuXHR9XG59Il19
