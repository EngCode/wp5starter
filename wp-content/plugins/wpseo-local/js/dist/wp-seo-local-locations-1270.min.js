(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class GeocodingRepository{static async geoCodeAddress(e){const o=new google.maps.Geocoder;if("object"==typeof e)return new Promise((t,s)=>{o.geocode(e,(e,o)=>"OK"===o?t(e):s(o))});throw new Error("Location should be an object")}}exports.default=GeocodingRepository;

},{}],2:[function(require,module,exports){
"use strict";var _wpSeoLocalGeocodingRepository=require("./wp-seo-local-geocoding-repository.js"),_wpSeoLocalGeocodingRepository2=_interopRequireDefault(_wpSeoLocalGeocodingRepository),_wpSeoLocalTimezoneRepository=require("./wp-seo-local-timezone-repository.js"),_wpSeoLocalTimezoneRepository2=_interopRequireDefault(_wpSeoLocalTimezoneRepository);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class Locations{constructor(){this.addressFields=[document.querySelector(".wpseo_local_address_input"),document.querySelector(".wpseo_local_zipcode_input"),document.querySelector(".wpseo_local_city_input"),document.querySelector(".wpseo_local_state_input"),document.querySelector('.select[id*="_country"]')],this.latLngSettingsContainer=document.getElementById("location-coordinates-settings"),this.latLngSettingsFieldWrapper=document.getElementById("location-coordinates-settings-lat-lng-wrapper"),this.calculateLatLngButton=document.getElementById("calculate_lat_lng_button"),this.latField=document.querySelector(".wpseo_local_lat_input"),this.lngField=document.querySelector(".wpseo_local_lng_input"),this.timezoneField=document.querySelector('select[id*="_timezone"]'),this.apiKey=wpseoLocalLocations.apiKey,this.maybeGeoCodeAddress=this.maybeGeoCodeAddress.bind(this),this.maybeShowAddressChangesNotification=this.maybeShowAddressChangesNotification.bind(this),this.setTimezone=this.setTimezone.bind(this),this.formatAddress=this.formatAddress.bind(this)}addEventListeners(){document.addEventListener("click",this.maybeGeoCodeAddress),document.addEventListener("change",this.maybeShowAddressChangesNotification)}async maybeGeoCodeAddress(e){if(null!==this.latField&&null!==this.lngField&&(this.calculateLatLngNotification=document.querySelector(".yoast-seo-local__alert"),this.calculateLatLngButton===e.target)){e.preventDefault(),this.errorField=document.querySelector(".wpseo_local_geocoding_error");const t=this.latField.value,o=this.lngField.value,i=this.formatAddress();null!==this.errorField&&this.errorField.parentNode.removeChild(this.errorField),this.latField.value="",this.lngField.value="";const a=document.createElement("div");try{const e=await _wpSeoLocalGeocodingRepository2.default.geoCodeAddress({address:i});this.latField.value=e[0].geometry.location.lat(),this.lngField.value=e[0].geometry.location.lng(),null!==this.calculateLatLngNotification&&this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification),a.innerHTML=wpseoLocalLocations.calculateLatLngSuccessMessage,this.latLngSettingsContainer.insertBefore(a,this.latLngSettingsFieldWrapper),(""!==this.latField.value&&""!==this.lngField.value&&this.latField.value!==t||this.lngField.value!==o)&&this.setTimezone()}catch(e){const t=document.createElement("p");switch(t.classList.add("wpseo_local_geocoding_error"),null!==this.calculateLatLngNotification&&this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification),a.innerHTML=wpseoLocalLocations.calculateLatLngErrorMessage,this.latLngSettingsContainer.insertBefore(a,this.latLngSettingsFieldWrapper),e){case"ZERO_RESULTS":t.appendChild(document.createTextNode("We could not retrieve coordinates for this address."));break;case"OVER_QUERY_LIMIT":t.appendChild(document.createTextNode("You are over your query limit."));break;case"REQUEST_DENIED":t.appendChild(document.createTextNode("Your API key is not entered or not valid."))}}}}async maybeShowAddressChangesNotification(e){if(-1!==this.addressFields.indexOf(e.target)){this.calculateLatLngNotification=document.querySelector(".yoast-seo-local__alert"),null!==this.calculateLatLngNotification&&this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification);const e=document.createElement("div");e.innerHTML=wpseoLocalLocations.addressChangedMessage,this.latLngSettingsContainer.insertBefore(e,this.latLngSettingsFieldWrapper)}}formatAddress(){let e=[];return this.addressFields.forEach(function(t){""!==t.value&&e.push(t.value)}),e.join(", ")}async setTimezone(){const e=this.latField.value+", "+this.lngField.value;try{const t=await _wpSeoLocalTimezoneRepository2.default.getTimezone(e,this.apiKey);""!==t&&jQuery(this.timezoneField).val(t).trigger("change")}catch(e){console.log(e)}}}const locationsInstance=new Locations;locationsInstance.addEventListeners();

},{"./wp-seo-local-geocoding-repository.js":1,"./wp-seo-local-timezone-repository.js":3}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class TimezoneRepository{static async getTimezone(e,t){const s=Math.floor(Date.now()/1e3),o=new URLSearchParams;o.append("location",e),o.append("timestamp",s),o.append("key",t);const n="https://maps.googleapis.com/maps/api/timezone/json?"+o;return new Promise((e,t)=>{const s=new XMLHttpRequest;s.open("GET",n),s.onload=(()=>{if(200===s.status){const o=JSON.parse(s.responseText);return"OK"===o.status?e(o.timeZoneId):t(o)}return t(s.status)}),s.send()})}}exports.default=TimezoneRepository;

},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9zcmMvd3Atc2VvLWxvY2FsLWdlb2NvZGluZy1yZXBvc2l0b3J5LmpzIiwianMvc3JjL3dwLXNlby1sb2NhbC1sb2NhdGlvbnMuanMiLCJqcy9zcmMvd3Atc2VvLWxvY2FsLXRpbWV6b25lLXJlcG9zaXRvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7b0VDR2UsTUFBTSxvQkFNcEIsNEJBQTZCLEdBQzVCLE1BQU0sRUFBVyxJQUFJLE9BQU8sS0FBSyxTQUVqQyxHQUF5QixpQkFBYixFQUNYLE9BQU8sSUFBSSxRQUFTLENBQUUsRUFBUyxLQUM5QixFQUFTLFFBQVMsRUFBVSxDQUFFLEVBQVMsSUFDdEIsT0FBWCxFQUNHLEVBQVMsR0FHVixFQUFRLE1BS2xCLE1BQU0sSUFBSSxNQUFPLGlEQXJCRTs7O2FDSHJCLElBQUEsK0JBQUEsUUFBQSxpSUFDQSw4QkFBQSxRQUFBLHNNQUtBLE1BQU0sVUFLTCxjQUNDLEtBQUssY0FBZ0IsQ0FDcEIsU0FBUyxjQUFlLDhCQUN4QixTQUFTLGNBQWUsOEJBQ3hCLFNBQVMsY0FBZSwyQkFDeEIsU0FBUyxjQUFlLDRCQUN4QixTQUFTLGNBQWUsNEJBR3pCLEtBQUssd0JBQTBCLFNBQVMsZUFBZ0IsaUNBQ3hELEtBQUssMkJBQTZCLFNBQVMsZUFBZ0IsaURBQzNELEtBQUssc0JBQXdCLFNBQVMsZUFBZ0IsNEJBRXRELEtBQUssU0FBVyxTQUFTLGNBQWUsMEJBQ3hDLEtBQUssU0FBVyxTQUFTLGNBQWUsMEJBRXhDLEtBQUssY0FBZ0IsU0FBUyxjQUFlLDJCQUU3QyxLQUFLLE9BQVMsb0JBQW9CLE9BRWxDLEtBQUssb0JBQXNCLEtBQUssb0JBQW9CLEtBQU0sTUFDMUQsS0FBSyxvQ0FBc0MsS0FBSyxvQ0FBb0MsS0FBTSxNQUMxRixLQUFLLFlBQWMsS0FBSyxZQUFZLEtBQU0sTUFDMUMsS0FBSyxjQUFnQixLQUFLLGNBQWMsS0FBTSxN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SSxLQUFNLE1BQU8sR0FDakIsRUFBSSxPQUFTLE1BQ1osR0FBbUIsTUFBZixFQUFJLE9BQWlCLENBQ3hCLE1BQU0sRUFBUyxLQUFLLE1BQU0sRUFBSSxjQUU5QixNQUFzQixPQUFsQixFQUFPLE9BQ0gsRUFBUyxFQUFPLFlBR2pCLEVBQVEsR0FHaEIsT0FBTyxFQUFRLEVBQUksVUFFcEIsRUFBSSwwQkFsQ2MiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIvKipcbiAqIHdwc2VvTG9jYWxHZW9jb2RpbmdSZXBvc2l0b3J5IGNsYXNzIGZvciBnZW9jb2RpbmcgYWRkcmVzc2VzLlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHZW9jb2RpbmdSZXBvc2l0b3J5IHtcblx0LyoqXG5cdCAqIEdlb2NvZGUgdGhlIGFkZHJlc3MgYmFzZWQgdXNpbmcgdGhlIEdvb2dsZSBtYXBzIEphdmFTY3JpcHQgZ2VvY29kaW5nIEFQSVxuXHQgKlxuXHQgKiBAdmFyIG9iamVjdCBBbiBvYmplY3QgY29udGFpbmluZyBlaXRoZXIgeyBcImFkZHJlc3NcIjogPGFkZHJlc3MgYXMgYSBzdHJpbmc+IH0gb3IgeyBcImxvY2F0aW9uXCI6IDx0aGUgTGF0TG5nIGNvb3JkaW5hdGVzPn1cblx0ICovXG5cdHN0YXRpYyBhc3luYyBnZW9Db2RlQWRkcmVzcyggbG9jYXRpb24gKSB7XG5cdFx0Y29uc3QgZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXIoKTtcblxuXHRcdGlmICggdHlwZW9mIGxvY2F0aW9uID09PSBcIm9iamVjdFwiICkge1xuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKCAoIHJlc29sdmUsIHJlamVjdCApID0+IHtcblx0XHRcdFx0Z2VvY29kZXIuZ2VvY29kZSggbG9jYXRpb24sICggcmVzdWx0cywgc3RhdHVzICkgPT4ge1xuXHRcdFx0XHRcdGlmICggc3RhdHVzID09PSBcIk9LXCIgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzb2x2ZSggcmVzdWx0cyApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByZWplY3QoIHN0YXR1cyApO1xuXHRcdFx0XHR9ICk7XG5cdFx0XHR9ICk7XG5cdFx0fVxuXG5cdFx0dGhyb3cgbmV3IEVycm9yKCBcIkxvY2F0aW9uIHNob3VsZCBiZSBhbiBvYmplY3RcIiApO1xuXHR9XG59IiwiaW1wb3J0IEdlb0NvZGluZ1JlcG9zaXRvcnkgZnJvbSBcIi4vd3Atc2VvLWxvY2FsLWdlb2NvZGluZy1yZXBvc2l0b3J5LmpzXCI7XG5pbXBvcnQgVGltZXpvbmVSZXBvc2l0b3J5IGZyb20gXCIuL3dwLXNlby1sb2NhbC10aW1lem9uZS1yZXBvc2l0b3J5LmpzXCI7XG5cbi8qKlxuICogQSBjbGFzcyB0byBoYW5kbGUgYWxsIGFkZHJlc3MgY2hhbmdlcyBhbmQgbWF5YmUgY2FsY3VsYXRlIG5ldyBsYXQvbG9uZyBhbmQgdGltZXpvbmUuXG4gKi9cbmNsYXNzIExvY2F0aW9ucyB7XG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RvciBmb3IgdGhlIHdwc2VvTG9jYWxHZW9jb2RpbmdSZXBvc2l0b3J5LlxuXHQgKiBIZXJlIHdlIGFzc2lnbiBmaWVsZHMgdG8gY2xhc3MgY29uc3RhbnRzIGFuZCBiaW5kIG1ldGhvZHMuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLmFkZHJlc3NGaWVsZHMgPSBbXG5cdFx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBcIi53cHNlb19sb2NhbF9hZGRyZXNzX2lucHV0XCIgKSxcblx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwiLndwc2VvX2xvY2FsX3ppcGNvZGVfaW5wdXRcIiApLFxuXHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIud3BzZW9fbG9jYWxfY2l0eV9pbnB1dFwiICksXG5cdFx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBcIi53cHNlb19sb2NhbF9zdGF0ZV9pbnB1dFwiICksXG5cdFx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBcIi5zZWxlY3RbaWQqPVxcXCJfY291bnRyeVxcXCJdXCIgKSxcblx0XHRdO1xuXG5cdFx0dGhpcy5sYXRMbmdTZXR0aW5nc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBcImxvY2F0aW9uLWNvb3JkaW5hdGVzLXNldHRpbmdzXCIgKTtcblx0XHR0aGlzLmxhdExuZ1NldHRpbmdzRmllbGRXcmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIFwibG9jYXRpb24tY29vcmRpbmF0ZXMtc2V0dGluZ3MtbGF0LWxuZy13cmFwcGVyXCIgKTtcblx0XHR0aGlzLmNhbGN1bGF0ZUxhdExuZ0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBcImNhbGN1bGF0ZV9sYXRfbG5nX2J1dHRvblwiICk7XG5cblx0XHR0aGlzLmxhdEZpZWxkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIud3BzZW9fbG9jYWxfbGF0X2lucHV0XCIgKTtcblx0XHR0aGlzLmxuZ0ZpZWxkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIud3BzZW9fbG9jYWxfbG5nX2lucHV0XCIgKTtcblxuXHRcdHRoaXMudGltZXpvbmVGaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwic2VsZWN0W2lkKj1cXFwiX3RpbWV6b25lXFxcIl1cIiApO1xuXG5cdFx0dGhpcy5hcGlLZXkgPSB3cHNlb0xvY2FsTG9jYXRpb25zLmFwaUtleTtcblxuXHRcdHRoaXMubWF5YmVHZW9Db2RlQWRkcmVzcyA9IHRoaXMubWF5YmVHZW9Db2RlQWRkcmVzcy5iaW5kKCB0aGlzICk7XG5cdFx0dGhpcy5tYXliZVNob3dBZGRyZXNzQ2hhbmdlc05vdGlmaWNhdGlvbiA9IHRoaXMubWF5YmVTaG93QWRkcmVzc0NoYW5nZXNOb3RpZmljYXRpb24uYmluZCggdGhpcyApO1xuXHRcdHRoaXMuc2V0VGltZXpvbmUgPSB0aGlzLnNldFRpbWV6b25lLmJpbmQoIHRoaXMgKTtcblx0XHR0aGlzLmZvcm1hdEFkZHJlc3MgPSB0aGlzLmZvcm1hdEFkZHJlc3MuYmluZCggdGhpcyApO1xuXHR9XG5cblx0LyoqXG5cdCAqIEFkZCBldmVudCBsaXN0ZW5lcnMgdG8gZmlyZSBhIGZ1bmN0aW9uIHVwb24gc3BlY2lmaWVkIGV2ZW50cy5cblx0ICovXG5cdGFkZEV2ZW50TGlzdGVuZXJzKCkge1xuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIFwiY2xpY2tcIiwgdGhpcy5tYXliZUdlb0NvZGVBZGRyZXNzICk7XG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggXCJjaGFuZ2VcIiwgdGhpcy5tYXliZVNob3dBZGRyZXNzQ2hhbmdlc05vdGlmaWNhdGlvbiApO1xuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrIHdoZXRlciBhIGFkZHJlc3Mgc2hvdWxkIGJlIGdlb2NvZGVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gZSBUaGUgZXZlbnQgcGFzc2VkIGJ5IHRoZSBldmVudCBsaXN0ZW5lci5cblx0ICovXG5cdGFzeW5jIG1heWJlR2VvQ29kZUFkZHJlc3MoIGUgKSB7XG5cdFx0LyoqXG5cdFx0ICogSWYgZWl0aGVyIHRoZSBsYXQgb3IgbG5nIGZpZWxkIGRvZXMgbm90IGV4aXN0IGJhaWwgdG8gYXZvaWQgKGNvbnNvbGUpZXJyb3JzLlxuXHRcdCAqL1xuXHRcdGlmICggdGhpcy5sYXRGaWVsZCA9PT0gbnVsbCB8fCB0aGlzLmxuZ0ZpZWxkID09PSBudWxsICkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIueW9hc3Qtc2VvLWxvY2FsX19hbGVydFwiICk7XG5cblx0XHRpZiAoIHRoaXMuY2FsY3VsYXRlTGF0TG5nQnV0dG9uID09PSBlLnRhcmdldCApIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHRoaXMuZXJyb3JGaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwiLndwc2VvX2xvY2FsX2dlb2NvZGluZ19lcnJvclwiICk7XG5cdFx0XHRjb25zdCBsYXRPbGRWYWx1ZSA9IHRoaXMubGF0RmllbGQudmFsdWU7XG5cdFx0XHRjb25zdCBsbmdPbGRWYWx1ZSA9IHRoaXMubG5nRmllbGQudmFsdWU7XG5cblx0XHRcdGNvbnN0IGZvcm1hdHRlZEFkZHJlc3MgPSB0aGlzLmZvcm1hdEFkZHJlc3MoKTtcblxuXHRcdFx0aWYgKCB0aGlzLmVycm9yRmllbGQgIT09IG51bGwgKSB7XG5cdFx0XHRcdHRoaXMuZXJyb3JGaWVsZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCB0aGlzLmVycm9yRmllbGQgKTtcblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBFbXB0eSB0aGUgbGF0L2xuZyBmaWVsZHMuIFRoZXkgd2lsbCBiZSByZWNhbGN1bGF0ZWQgYW5kIHJlc3VsdCBpbiBlbXB0eSBmaWVsZHMgaWYgZ2VvY29kaW5nIGZhaWxlZC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAdHlwZSB7c3RyaW5nfVxuXHRcdFx0ICovXG5cdFx0XHR0aGlzLmxhdEZpZWxkLnZhbHVlID0gXCJcIjtcblx0XHRcdHRoaXMubG5nRmllbGQudmFsdWUgPSBcIlwiO1xuXG5cdFx0XHRjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggXCJkaXZcIiApO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIFRyeSBHZW9jb2Rpbmcgb2YgdGhlIGdpdmVuIGFkZHJlc3MuIElmIGl0IGZhaWxzIGdlbmVyYXRlIGFuIGVycm9yIG1lc3NhZ2UgYmFzZWQgb24gdGhlIHJldHVybmVkIGVycm9yLlxuXHRcdFx0ICovXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgR2VvQ29kaW5nUmVwb3NpdG9yeS5nZW9Db2RlQWRkcmVzcyggeyBhZGRyZXNzOiBmb3JtYXR0ZWRBZGRyZXNzIH0gKTtcblxuXHRcdFx0XHR0aGlzLmxhdEZpZWxkLnZhbHVlID0gcmVzdWx0c1sgMCBdLmdlb21ldHJ5LmxvY2F0aW9uLmxhdCgpO1xuXHRcdFx0XHR0aGlzLmxuZ0ZpZWxkLnZhbHVlID0gcmVzdWx0c1sgMCBdLmdlb21ldHJ5LmxvY2F0aW9uLmxuZygpO1xuXG5cdFx0XHRcdGlmICggdGhpcy5jYWxjdWxhdGVMYXRMbmdOb3RpZmljYXRpb24gIT09IG51bGwgKSB7XG5cdFx0XHRcdFx0dGhpcy5jYWxjdWxhdGVMYXRMbmdOb3RpZmljYXRpb24ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggdGhpcy5jYWxjdWxhdGVMYXRMbmdOb3RpZmljYXRpb24gKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR3cmFwcGVyLmlubmVySFRNTCA9IHdwc2VvTG9jYWxMb2NhdGlvbnMuY2FsY3VsYXRlTGF0TG5nU3VjY2Vzc01lc3NhZ2U7XG5cblx0XHRcdFx0dGhpcy5sYXRMbmdTZXR0aW5nc0NvbnRhaW5lci5pbnNlcnRCZWZvcmUoIHdyYXBwZXIsIHRoaXMubGF0TG5nU2V0dGluZ3NGaWVsZFdyYXBwZXIgKTtcblxuXHRcdFx0XHRpZiAoIHRoaXMubGF0RmllbGQudmFsdWUgIT09IFwiXCIgJiYgdGhpcy5sbmdGaWVsZC52YWx1ZSAhPT0gXCJcIiAmJiB0aGlzLmxhdEZpZWxkLnZhbHVlICE9PSBsYXRPbGRWYWx1ZSB8fCB0aGlzLmxuZ0ZpZWxkLnZhbHVlICE9PSBsbmdPbGRWYWx1ZSApIHtcblx0XHRcdFx0XHR0aGlzLnNldFRpbWV6b25lKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBjYXRjaCAoIGVycm9yICkge1xuXHRcdFx0XHRjb25zdCBlcnJvckZpZWxkRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIFwicFwiICk7XG5cdFx0XHRcdGVycm9yRmllbGRFbGVtZW50LmNsYXNzTGlzdC5hZGQoIFwid3BzZW9fbG9jYWxfZ2VvY29kaW5nX2Vycm9yXCIgKTtcblxuXHRcdFx0XHRpZiAoIHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uICE9PSBudWxsICkge1xuXHRcdFx0XHRcdHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0d3JhcHBlci5pbm5lckhUTUwgPSB3cHNlb0xvY2FsTG9jYXRpb25zLmNhbGN1bGF0ZUxhdExuZ0Vycm9yTWVzc2FnZTtcblx0XHRcdFx0dGhpcy5sYXRMbmdTZXR0aW5nc0NvbnRhaW5lci5pbnNlcnRCZWZvcmUoIHdyYXBwZXIsIHRoaXMubGF0TG5nU2V0dGluZ3NGaWVsZFdyYXBwZXIgKTtcblxuXHRcdFx0XHRzd2l0Y2ggKCBlcnJvciApIHtcblx0XHRcdFx0XHRjYXNlIFwiWkVST19SRVNVTFRTXCI6XG5cdFx0XHRcdFx0XHRlcnJvckZpZWxkRWxlbWVudC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIFwiV2UgY291bGQgbm90IHJldHJpZXZlIGNvb3JkaW5hdGVzIGZvciB0aGlzIGFkZHJlc3MuXCIgKSApO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSBcIk9WRVJfUVVFUllfTElNSVRcIjpcblx0XHRcdFx0XHRcdGVycm9yRmllbGRFbGVtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggXCJZb3UgYXJlIG92ZXIgeW91ciBxdWVyeSBsaW1pdC5cIiApICk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIFwiUkVRVUVTVF9ERU5JRURcIjpcblx0XHRcdFx0XHRcdGVycm9yRmllbGRFbGVtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggXCJZb3VyIEFQSSBrZXkgaXMgbm90IGVudGVyZWQgb3Igbm90IHZhbGlkLlwiICkgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIERpc3BsYXkgdGhlIGVycm9yIGFmdGVyIHRoZSBsb25naXR1ZGUgZmllbGQuXG5cdFx0XHRcdC8vIEBub3RlOiBUZW1wb3JhcmlseSByZW1vdmVkLiBXaWxsIGFkZCB0aGlzIGJhY2sgbGF0ZXIuXG5cdFx0XHRcdC8vIHRoaXMubG5nRmllbGQucGFyZW50Tm9kZS5hZnRlciggZXJyb3JGaWVsZEVsZW1lbnQgKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRhc3luYyBtYXliZVNob3dBZGRyZXNzQ2hhbmdlc05vdGlmaWNhdGlvbiggZSApIHtcblx0XHRpZiAoIHRoaXMuYWRkcmVzc0ZpZWxkcy5pbmRleE9mKCBlLnRhcmdldCApICE9PSAtMSApIHtcblx0XHRcdHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIueW9hc3Qtc2VvLWxvY2FsX19hbGVydFwiICk7XG5cblx0XHRcdGlmICggdGhpcy5jYWxjdWxhdGVMYXRMbmdOb3RpZmljYXRpb24gIT09IG51bGwgKSB7XG5cdFx0XHRcdHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIHRoaXMuY2FsY3VsYXRlTGF0TG5nTm90aWZpY2F0aW9uICk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBcImRpdlwiICk7XG5cdFx0XHR3cmFwcGVyLmlubmVySFRNTCA9IHdwc2VvTG9jYWxMb2NhdGlvbnMuYWRkcmVzc0NoYW5nZWRNZXNzYWdlO1xuXG5cdFx0XHR0aGlzLmxhdExuZ1NldHRpbmdzQ29udGFpbmVyLmluc2VydEJlZm9yZSggd3JhcHBlciwgdGhpcy5sYXRMbmdTZXR0aW5nc0ZpZWxkV3JhcHBlciApO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBGb3JtYXQgYW4gYWRkcmVzcyB0aGUgR29vZ2xlIEdlb2NvZGVyIGNhbiB1c2UgYmFzZWQgb24gdGhlIGZpbGxlZCBpbiBhZGRyZXNzIGZpZWxkcy5cblx0ICpcblx0ICogQHJldHVybnMge3N0cmluZ31cblx0ICovXG5cdGZvcm1hdEFkZHJlc3MoKSB7XG5cdFx0bGV0IGFkZHJlc3MgPSBbXTtcblxuXHRcdHRoaXMuYWRkcmVzc0ZpZWxkcy5mb3JFYWNoKCBmdW5jdGlvbiggYWRkcmVzc0ZpZWxkICkge1xuXHRcdFx0aWYgKCBhZGRyZXNzRmllbGQudmFsdWUgIT09IFwiXCIgKSB7XG5cdFx0XHRcdGFkZHJlc3MucHVzaCggYWRkcmVzc0ZpZWxkLnZhbHVlICk7XG5cdFx0XHR9XG5cdFx0fSApO1xuXG5cdFx0cmV0dXJuIGFkZHJlc3Muam9pbiggXCIsIFwiICk7XG5cdH1cblxuXHRhc3luYyBzZXRUaW1lem9uZSgpIHtcblx0XHQvKipcblx0XHQgKiBDaGVjayBpZiBlaXRoZXIgdGhlIGxhdCBvciBsbmcgZmllbGQgaGFzIGNoYW5nZWQgYW5kIGlmIHRoZXkgYXJlIG5vdCBlbXB0eVxuXHRcdCAqL1xuXHRcdGNvbnN0IGxhdExuZyA9IHRoaXMubGF0RmllbGQudmFsdWUgKyBcIiwgXCIgKyB0aGlzLmxuZ0ZpZWxkLnZhbHVlO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRpbWV6b25lUmVwb3NpdG9yeS5nZXRUaW1lem9uZSggbGF0TG5nLCB0aGlzLmFwaUtleSApO1xuXG5cdFx0XHRpZiAoIHJlc3VsdCAhPT0gXCJcIiApIHtcblx0XHRcdFx0alF1ZXJ5KCB0aGlzLnRpbWV6b25lRmllbGQgKS52YWwoIHJlc3VsdCApLnRyaWdnZXIoIFwiY2hhbmdlXCIgKTtcblx0XHRcdH1cblx0XHR9IGNhdGNoICggZXJyb3IgKSB7XG5cdFx0XHRjb25zb2xlLmxvZyggZXJyb3IgKTtcblx0XHR9XG5cdH1cbn1cblxuY29uc3QgbG9jYXRpb25zSW5zdGFuY2UgPSBuZXcgTG9jYXRpb25zKCk7XG5cbmxvY2F0aW9uc0luc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXJzKCk7XG4iLCIvKipcbiAqIFRpbWV6b25lUmVwb3NpdG9yeSBjbGFzcyBmb3IgcmV0cmlldmluZyB0aGUgdGltZXpvbmUgYmFzZWQgYmFzZWQgb24gbGF0L2xuZyBjb29yZGluYXRlcy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXpvbmVSZXBvc2l0b3J5IHtcblx0LyoqXG5cdCAqIEdldCB0aGUgdGltZXpvbmUgZnJvbSBHb29nbGUncyBUaW1lem9uZSBBUElcblx0ICpcblx0ICogQHZhciBvYmplY3QgQW4gb2JqZWN0IGNvbnRhaW5pbmcgZWl0aGVyIHsgXCJhZGRyZXNzXCI6IDxhZGRyZXNzIGFzIGEgc3RyaW5nPiB9IG9yIHsgXCJsb2NhdGlvblwiOiA8dGhlIExhdExuZyBjb29yZGluYXRlcz59XG5cdCAqL1xuXHRzdGF0aWMgYXN5bmMgZ2V0VGltZXpvbmUoIGxhdExuZywgYXBpS2V5ICkge1xuXHRcdGNvbnN0IHRpbWVzdGFtcCA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApO1xuXG5cdFx0Y29uc3Qgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpO1xuXG5cdFx0c2VhcmNoUGFyYW1zLmFwcGVuZCggXCJsb2NhdGlvblwiLCBsYXRMbmcgKTtcblx0XHRzZWFyY2hQYXJhbXMuYXBwZW5kKCBcInRpbWVzdGFtcFwiLCB0aW1lc3RhbXAgKTtcblx0XHRzZWFyY2hQYXJhbXMuYXBwZW5kKCBcImtleVwiLCBhcGlLZXkgKTtcblxuXHRcdGNvbnN0IHJlcXVlc3QgPSBcImh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS90aW1lem9uZS9qc29uP1wiICsgc2VhcmNoUGFyYW1zO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKCAoIHJlc29sdmUsIHJlamVjdCApID0+IHtcblx0XHRcdGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG5cdFx0XHR4aHIub3BlbiggXCJHRVRcIiwgcmVxdWVzdCApO1xuXHRcdFx0eGhyLm9ubG9hZCA9ICgpID0+IHtcblx0XHRcdFx0aWYoIHhoci5zdGF0dXMgPT09IDIwMCApIHtcblx0XHRcdFx0XHRjb25zdCBvdXRwdXQgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuXG5cdFx0XHRcdFx0aWYoIG91dHB1dC5zdGF0dXMgPT09ICdPSycgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzb2x2ZSggb3V0cHV0LnRpbWVab25lSWQgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcmVqZWN0KCBvdXRwdXQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJlamVjdCggeGhyLnN0YXR1cyApO1xuXHRcdFx0fVxuXHRcdFx0eGhyLnNlbmQoKTtcblx0XHR9ICk7XG5cdH1cbn0iXX0=
